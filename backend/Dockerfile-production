FROM node:22-alpine

WORKDIR /app

# Instalar curl para healthcheck
RUN apk add --no-cache curl

# Copiar build pronto (vem do artifact)
COPY build/ ./
COPY node_modules/ ./node_modules/
COPY package.json ./

# Criar diretório storage
RUN mkdir -p ./_storage

# Copiar logos padrão
COPY _storage/large.png _storage/small.png ./_storage/

# Usuário não-root
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001 -G nodejs && \
    chown -R nodejs:nodejs /app

USER nodejs

EXPOSE 3000

CMD ["node", "bin/server.js"]
